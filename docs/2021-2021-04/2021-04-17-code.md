# 2021å¹´04æœˆ17æ—¥ code
<a href="https://toutiao.io/k/wqo3p4x">å¤§æ•°æ®å‘Šè¯‰ä½ ï¼šç¨‹åºå‘˜çœŸçš„æ˜¯åƒé’æ˜¥é¥­çš„å—ï¼Ÿ</a><br /><a href="https://toutiao.io/k/4xposai">Redis å…¥é—¨-æ•°æ®ç±»å‹ï¼š3 ç§ç‰¹æ®Šç±»å‹è¯¦è§£</a><br /><a href="https://toutiao.io/k/ae23a9e">æµ·é‡æ•°æ®ä¸šåŠ¡æœ‰å“ªäº›ä¼˜åŒ–æ‰‹æ®µï¼Ÿ</a><br /><a href="https://toutiao.io/k/gxfqnlm">Java 8 ä¸­çš„é»˜è®¤æ–¹æ³•</a><br /><a href="https://toutiao.io/k/n0xgxs1">MySQL æå‡ç¬”è®°ï¼ˆä¸€ï¼‰ï¼šMySQL é€»è¾‘æ¶æ„</a><br /><a href="https://toutiao.io/k/8rglg7c">Go å¯ç”¨æ€§ï¼ˆäº”ï¼‰ï¼šè‡ªé€‚åº”é™æµ</a><br /><a href="https://toutiao.io/k/zxa65u1">è¶…çº§è¯¦ç»†çš„ Spring Boot æ³¨è§£æ€»ç»“</a><br /><a href="https://toutiao.io/k/00axfg8">Kubernetes éƒ¨ç½²åˆ©å™¨ Helm å¿«é€Ÿå…¥é—¨</a><br /><a href="https://toutiao.io/k/0clcea6">Go è¯­è¨€å†…éƒ¨åŒ…ï¼šæ§åˆ¶åŒ…æˆå‘˜çš„å¯¹å¤–æš´éœ²</a><br /><a href="https://toutiao.io/k/5a4o9sd">ä½å¼€é”€è·å–æ—¶é—´æˆ³</a><br /><a href="https://toutiao.io/k/yjh1gaw">ConcurrentHashMap æœ‰åä¸ªæå‡æ€§èƒ½çš„åœ°æ–¹ï¼Œä½ éƒ½çŸ¥é“å—ï¼Ÿ</a><br /><a href="https://toutiao.io/k/2bkoq2d">å¼ºå¤§çš„ Guava å·¥å…·ç±»</a><br /><a href="https://toutiao.io/k/2kqd6u0">Xcode ç¼–è¯‘ç–¾å¦‚é£ç³»åˆ—ï¼ˆäºŒï¼‰ï¼šå¹¶è¡Œç¼–è¯‘</a><br /><a href="https://toutiao.io/k/cbozvmj">ThreadPoolExecutor çº¿ç¨‹æ± ä½¿ç”¨</a><br /><a href="https://toutiao.io/k/ot335il">æ´å¯Ÿè®¾è®¡æ¨¡å¼çš„åº•å±‚é€»è¾‘</a><br /><a href="https://toutiao.io/k/nubisvh">è°·æ­Œæ˜¯å¦‚ä½•åšåº”æ€¥å“åº”çš„</a><br /><a href="https://toutiao.io/k/cd109fv">2021 ThoughtWorks æŠ€æœ¯é›·è¾¾å³°ä¼š - å…¨è®²å¸ˆé˜µå®¹éœ‡æ’¼å‘å¸ƒ</a><br /><a href="https://toutiao.io/k/9rduy12">ä½ å¯èƒ½ä¸çŸ¥é“çš„ ZooKeeper çŸ¥è¯†ç‚¹</a><br /><a href="https://toutiao.io/k/od4cvmz">Spark æ¨èå®æˆ˜ç³»åˆ—ä¹‹ Swing ç®—æ³•ä»‹ç»ã€å®ç°ä¸åœ¨é˜¿é‡Œé£çŒªçš„å®æˆ˜åº”ç”¨</a><br /><a href="https://toutiao.io/k/59ft88o">Hexo åŸºäºåˆ†ç±»è¾“å‡ºæ–‡ç« </a><br /><a href="https://toutiao.io/k/68q4m1v">[æ¨è] æ¶æ„è®¾è®¡æ–¹æ³•è®º</a><br /><a href="https://toutiao.io/k/gauwubg">[æ¨è] æˆ‘å¾ˆä¹…æ²¡å†™ä»£ç äº†ï¼Œä½†æˆ‘æ˜¯ä¸ªå¥½æ¶æ„å¸ˆ</a><br /><a href="https://toutiao.io/k/feyaceo">[æ¨è] ä¸¤æ¬¡è¢«è£ä¹‹åï¼Œæˆ‘ç»ˆäºè§£å†³äº†æ•°æ®åº“ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</a><br /><a href="https://toutiao.io/k/906zu1i">[æ¨è] æ•™ä½ ä»å¤´å†™æ¸¸æˆæœåŠ¡å™¨æ¡†æ¶</a><br /><a href="https://toutiao.io/k/bi1fr9y">[æ¨è] ç äº‘ Giteeï¼šé«˜å¹¶å‘å¤§å­˜å‚¨ä¸‹çš„æ¶æ„æ¼”è¿›ä¹‹è·¯</a><br /><a href="https://toutiao.io/k/z5c0vp0">[æ¨è] è°ˆè°ˆ MySQL é”</a><br /><a href="https://toutiao.io/k/zdnq3fy">[æ¨è] è¸©å‘ MySQL ç´¢å¼•ï¼Œçœ‹çœ‹ä½ çœŸçš„ä¼šç”¨å—ï¼Ÿ</a><br /><a href="https://toutiao.io/k/hti1ill">[æ¨è] å…¶å®ï¼Œæ¯æ¬¡é¢è¯•çš„é—®é¢˜éƒ½é€ƒä¸è¿‡è¿™å‡ æ–¹é¢</a><br /><a href="https://toutiao.io/k/zpo0xd7">[æ¨è] èŒåœºï¼šå·¥ä½œäº”å¹´ä¹‹åï¼Œå¯¹æŠ€æœ¯å’Œä¸šåŠ¡çš„æ€è€ƒ</a><br /><a href="https://toutiao.io/k/3bv147y">[æ¨è] å…è´¹æ­£ç‰ˆ IntelliJ IDEA license è¯¦ç»†æŒ‡å—</a><br /><a href="https://toutiao.io/k/we8gr61">[æ¨è] ä»éœ€æ±‚å‡ºå‘è®¾è®¡ä¸€æ¡å¼€æºæŒç»­éƒ¨ç½²æµæ°´çº¿</a><br /><a href="https://toutiao.io/k/pmlwnuy">[æ¨è] æœ‰å“ªäº›å¯ä»¥æé«˜ä»£ç è´¨é‡çš„ä¹¦ç±æ¨èï¼Ÿ</a><br /><a href="https://toutiao.io/k/oa4amzb">[æ¨è] ä½¿ç”¨ Git ä¸¢å¤±ä»£ç çš„ N ç§æ“ä½œï¼Œæ‚¨ä¸­æ‹›äº†å—ï¼Ÿ</a><br /><a href="https://toutiao.io/k/6aau0fc">[æ¨è] ä¸€æ–‡è¯»æ‡‚ï¼ŒDDD è½åœ°æ•°æ®åº“è®¾è®¡å®æˆ˜</a><br /><a href="https://toutiao.io/k/82eogba">[æ¨è] Git åˆ†æ”¯ç®¡ç†ç­–ç•¥ä¸å·¥ä½œæµç¨‹</a><br /><hr /><a href="https://github.com/openethereum/openethereum">The fast, light, and robust client for the Ethereum mainnet.</a><br /><a href="https://github.com/Chia-Network/chia-blockchain">Chia blockchain python implementation (full node, farmer, harvester, timelord, and wallet)</a><br /><a href="https://github.com/Forescout/project-memoria-detector"></a><br /><a href="https://github.com/ChristianChiarulli/LunarVim">A Neovim config made with sane defaults</a><br /><a href="https://github.com/login?return_to=%2Fferib%2FD2R-Offline">Diablo II: Resurrected, Offline-mode patcher</a><br /><a href="https://github.com/PathOfBuildingCommunity/PathOfBuilding">Offline build planner for Path of Exile.</a><br /><a href="https://github.com/avboy1337/1195777-chrome0day"></a><br /><a href="https://github.com/ashishpatel26/500-AI-Machine-learning-Deep-learning-Computer-vision-NLP-Projects-with-code">500 AI Machine learning Deep learning Computer vision NLP Projects with code</a><br /><a href="https://github.com/qiurunze123/miaosha">â­â­â­â­ç§’æ€ç³»ç»Ÿè®¾è®¡ä¸å®ç°.äº’è”ç½‘å·¥ç¨‹å¸ˆè¿›é˜¶ä¸åˆ†æğŸ™‹ğŸ“</a><br /><a href="https://github.com/coqui-ai/TTS">ğŸ¸ğŸ’¬ - a deep learning toolkit for Text-to-Speech, battle-tested in research and production</a><br /><a href="https://github.com/hhroot/2021_Hvv">2021 hw</a><br /><a href="https://github.com/MohamedYoussouf/Design-Resources">A curated list of design resources from design templates, stock photos, icons, colors, and much more.</a><br /><a href="https://github.com/EvgSkv/logica">Logica is a logic programming language that compiles to StandardSQL and runs on Google BigQuery.</a><br /><a href="https://github.com/rby90/project-based-tutorials-in-c">A curated list of project-based tutorials in C</a><br /><a href="https://github.com/encoredev/encore">The Go backend framework with superpowers</a><br /><a href="https://github.com/louisfb01/start-machine-learning-in-2020">A complete guide to start and improve in machine learning (ML), artificial intelligence (AI) in 2021 without ANY background in the field and stay up-to-date with the latest news and state-of-the-art techniques!</a><br /><a href="https://github.com/login?return_to=%2Fnlohmann%2Fjson">JSON for Modern C++</a><br /><a href="https://github.com/tauri-apps/tauri">Build smaller, faster, and more secure desktop applications with a web frontend.</a><br /><a href="https://github.com/GorvGoyl/Clone-Wars">100+ open-source clones of popular sites like Airbnb, Amazon, Instagram, Netflix, Tiktok, Spotify, Whatsapp, Youtube etc. See source code, demo links, tech stack, github stars.</a><br /><a href="https://github.com/huggingface/transformers">ğŸ¤—Transformers: State-of-the-art Natural Language Processing for Pytorch and TensorFlow 2.0.</a><br /><a href="https://github.com/elixir-nx/livebook">Interactive and collaborative code notebooks - made with Phoenix LiveView.</a><br /><a href="https://github.com/dogecoin/dogecoin">very currency</a><br /><a href="https://github.com/easychen/one-person-businesses-methodology">ä¸€äººå…¬å¸æ–¹æ³•è®º</a><br /><a href="https://github.com/alberteije/T2Ti-Pegasus-PDV-Lite">RepositÃ³rio do Projeto T2Ti Pegasus PDV Lite</a><br /><a href="https://github.com/opensearch-project/OpenSearch">Open source distributed and RESTful search engine.</a><br /><hr />å­˜åœ¨é‡å¤å…ƒç´  III<br /><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸¤ä¸ªæ•´æ•°Â <code>k</code> å’Œ <code>t</code> ã€‚è¯·ä½ åˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸¤ä¸ªä¸‹æ ‡ <code>i</code> å’Œ <code>j</code>ï¼Œä½¿å¾—Â <code>abs(nums[i] - nums[j]) <= t</code> ï¼ŒåŒæ—¶åˆæ»¡è¶³ <code>abs(i - j) <= k</code><em> </em>ã€‚</p>

<p>å¦‚æœå­˜åœ¨åˆ™è¿”å› <code>true</code>ï¼Œä¸å­˜åœ¨è¿”å› <code>false</code>ã€‚</p>

<p>Â </p>

<p><strong>ç¤ºä¾‹Â 1ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>nums = [1,2,3,1], k<em> </em>= 3, t = 0
<strong>è¾“å‡ºï¼š</strong>true</pre>

<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>nums = [1,0,1,1], k<em> </em>=<em> </em>1, t = 2
<strong>è¾“å‡ºï¼š</strong>true</pre>

<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>nums = [1,5,9,1,5,9], k = 2, t = 3
<strong>è¾“å‡ºï¼š</strong>false</pre>

<p>Â </p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>0 <= nums.length <= 2 * 10<sup>4</sup></code></li>
	<li><code>-2<sup>31</sup> <= nums[i] <= 2<sup>31</sup> - 1</code></li>
	<li><code>0 <= k <= 10<sup>4</sup></code></li>
	<li><code>0 <= t <= 2<sup>31</sup> - 1</code></li>
</ul>
<br />#### æ–¹æ³•ä¸€ï¼šæ»‘åŠ¨çª—å£ + æœ‰åºé›†åˆ

**æ€è·¯åŠç®—æ³•**

å¯¹äºåºåˆ—ä¸­æ¯ä¸€ä¸ªå…ƒç´  $x$ å·¦ä¾§çš„è‡³å¤š $k$ ä¸ªå…ƒç´ ï¼Œå¦‚æœè¿™ $k$ ä¸ªå…ƒç´ ä¸­å­˜åœ¨ä¸€ä¸ªå…ƒç´ è½åœ¨åŒºé—´ $[x - t, x + t]$ ä¸­ï¼Œæˆ‘ä»¬å°±æ‰¾åˆ°äº†ä¸€å¯¹ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ã€‚æ³¨æ„åˆ°å¯¹äºä¸¤ä¸ªç›¸é‚»çš„å…ƒç´ ï¼Œå®ƒä»¬å„è‡ªçš„å·¦ä¾§çš„ $k$ ä¸ªå…ƒç´ ä¸­æœ‰ $k - 1$ ä¸ªæ˜¯é‡åˆçš„ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ»‘åŠ¨çª—å£çš„æ€è·¯ï¼Œç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º $k$ çš„æ»‘åŠ¨çª—å£ï¼Œæ¯æ¬¡éå†åˆ°å…ƒç´  $x$ æ—¶ï¼Œæ»‘åŠ¨çª—å£ä¸­åŒ…å«å…ƒç´  $x$ å‰é¢çš„æœ€å¤š $k$ ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬æ£€æŸ¥çª—å£ä¸­æ˜¯å¦å­˜åœ¨å…ƒç´ è½åœ¨åŒºé—´ $[x - t, x + t]$ ä¸­å³å¯ã€‚

å¦‚æœä½¿ç”¨é˜Ÿåˆ—ç»´æŠ¤æ»‘åŠ¨çª—å£å†…çš„å…ƒç´ ï¼Œç”±äºå…ƒç´ æ˜¯æ— åºçš„ï¼Œæˆ‘ä»¬åªèƒ½å¯¹äºæ¯ä¸ªå…ƒç´ éƒ½éå†ä¸€æ¬¡é˜Ÿåˆ—æ¥æ£€æŸ¥æ˜¯å¦æœ‰å…ƒç´ ç¬¦åˆæ¡ä»¶ã€‚å¦‚æœæ•°ç»„çš„é•¿åº¦ä¸º $n$ï¼Œåˆ™ä½¿ç”¨é˜Ÿåˆ—çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(nk)$ï¼Œä¼šè¶…å‡ºæ—¶é—´é™åˆ¶ã€‚

å› æ­¤æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿæ‰¾åˆ°ä¸€ä¸ªæ•°æ®ç»“æ„ç»´æŠ¤æ»‘åŠ¨çª—å£å†…çš„å…ƒç´ ï¼Œè¯¥æ•°æ®ç»“æ„éœ€è¦æ»¡è¶³ä»¥ä¸‹æ“ä½œï¼š

- æ”¯æŒæ·»åŠ å’Œåˆ é™¤æŒ‡å®šå…ƒç´ çš„æ“ä½œï¼Œå¦åˆ™æˆ‘ä»¬æ— æ³•ç»´æŠ¤æ»‘åŠ¨çª—å£ï¼›

- å†…éƒ¨å…ƒç´ æœ‰åºï¼Œæ”¯æŒäºŒåˆ†æŸ¥æ‰¾çš„æ“ä½œï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å¿«é€Ÿåˆ¤æ–­æ»‘åŠ¨çª—å£ä¸­æ˜¯å¦å­˜åœ¨å…ƒç´ æ»¡è¶³æ¡ä»¶ï¼Œå…·ä½“è€Œè¨€ï¼Œå¯¹äºå…ƒç´  $x$ï¼Œå½“æˆ‘ä»¬å¸Œæœ›åˆ¤æ–­æ»‘åŠ¨çª—å£ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªæ•° $y$ è½åœ¨åŒºé—´ $[x - t, x + t]$ ä¸­ï¼Œåªéœ€è¦åˆ¤æ–­æ»‘åŠ¨çª—å£ä¸­æ‰€æœ‰å¤§äºç­‰äº $x - t$ çš„å…ƒç´ ä¸­çš„æœ€å°å…ƒç´ æ˜¯å¦å°äºç­‰äº $x + t$ å³å¯ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ‰åºé›†åˆæ¥æ”¯æŒè¿™äº›æ“ä½œã€‚

å®ç°æ–¹é¢ï¼Œæˆ‘ä»¬åœ¨æœ‰åºé›†åˆä¸­æŸ¥æ‰¾å¤§äºç­‰äº $x - t$ çš„æœ€å°çš„å…ƒç´  $y$ï¼Œå¦‚æœ $y$ å­˜åœ¨ï¼Œä¸” $y \leq x + t$ï¼Œæˆ‘ä»¬å°±æ‰¾åˆ°äº†ä¸€å¯¹ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ã€‚å®Œæˆæ£€æŸ¥åï¼Œæˆ‘ä»¬å°† $x$ æ’å…¥åˆ°æœ‰åºé›†åˆä¸­ï¼Œå¦‚æœæœ‰åºé›†åˆä¸­å…ƒç´ æ•°é‡è¶…è¿‡äº† $k$ï¼Œæˆ‘ä»¬å°†æœ‰åºé›†åˆä¸­æœ€æ—©è¢«æ’å…¥çš„å…ƒç´ åˆ é™¤å³å¯ã€‚

**æ³¨æ„**

å¦‚æœå½“å‰æœ‰åºé›†åˆä¸­å­˜åœ¨ç›¸åŒå…ƒç´ ï¼Œé‚£ä¹ˆæ­¤æ—¶ç¨‹åºå°†ç›´æ¥è¿”å› $\texttt{true}$ã€‚å› æ­¤æœ¬é¢˜ä¸­çš„æœ‰åºé›†åˆæ— éœ€å¤„ç†ç›¸åŒå…ƒç´ çš„æƒ…å†µã€‚

ä¸ºé˜²æ­¢æ•´å‹ $\texttt{int}$ æº¢å‡ºï¼Œæˆ‘ä»¬æ—¢å¯ä»¥ä½¿ç”¨é•¿æ•´å‹ $\texttt{long}$ï¼Œä¹Ÿå¯ä»¥å¯¹æŸ¥æ‰¾åŒºé—´ $[x - t, x + t]$ è¿›è¡Œé™åˆ¶ï¼Œä½¿å…¶è½åœ¨ $\texttt{int}$ èŒƒå›´å†…ã€‚

**ä»£ç **

```C++ [sol1-C++]
class Solution {
public:
    bool containsNearbyAlmostDuplicate(vector<int>& nums, int k, int t) {
        int n = nums.size();
        set<int> rec;
        for (int i = 0; i < n; i++) {
            auto iter = rec.lower_bound(max(nums[i], INT_MIN + t) - t);
            if (iter != rec.end() && *iter <= min(nums[i], INT_MAX - t) + t) {
                return true;
            }
            rec.insert(nums[i]);
            if (i >= k) {
                rec.erase(nums[i - k]);
            }
        }
        return false;
    }
};
```

```Java [sol1-Java]
class Solution {
    public boolean containsNearbyAlmostDuplicate(int[] nums, int k, int t) {
        int n = nums.length;
        TreeSet<Long> set = new TreeSet<Long>();
        for (int i = 0; i < n; i++) {
            Long ceiling = set.ceiling((long) nums[i] - (long) t);
            if (ceiling != null && ceiling <= (long) nums[i] + (long) t) {
                return true;
            }
            set.add((long) nums[i]);
            if (i >= k) {
                set.remove((long) nums[i - k]);
            }
        }
        return false;
    }
}
```

```go [sol1-Golang]
import "math/rand"

type node struct {
    ch       [2]*node
    priority int
    val      int
}

func (o *node) cmp(b int) int {
    switch {
    case b < o.val:
        return 0
    case b > o.val:
        return 1
    default:
        return -1
    }
}

func (o *node) rotate(d int) *node {
    x := o.ch[d^1]
    o.ch[d^1] = x.ch[d]
    x.ch[d] = o
    return x
}

type treap struct {
    root *node
}

func (t *treap) _put(o *node, val int) *node {
    if o == nil {
        return &node{priority: rand.Int(), val: val}
    }
    d := o.cmp(val)
    o.ch[d] = t._put(o.ch[d], val)
    if o.ch[d].priority > o.priority {
        o = o.rotate(d ^ 1)
    }
    return o
}

func (t *treap) put(val int) {
    t.root = t._put(t.root, val)
}

func (t *treap) _delete(o *node, val int) *node {
    if d := o.cmp(val); d >= 0 {
        o.ch[d] = t._delete(o.ch[d], val)
        return o
    }
    if o.ch[1] == nil {
        return o.ch[0]
    }
    if o.ch[0] == nil {
        return o.ch[1]
    }
    d := 0
    if o.ch[0].priority > o.ch[1].priority {
        d = 1
    }
    o = o.rotate(d)
    o.ch[d] = t._delete(o.ch[d], val)
    return o
}

func (t *treap) delete(val int) {
    t.root = t._delete(t.root, val)
}

func (t *treap) lowerBound(val int) (lb *node) {
    for o := t.root; o != nil; {
        switch c := o.cmp(val); {
        case c == 0:
            lb = o
            o = o.ch[0]
        case c > 0:
            o = o.ch[1]
        default:
            return o
        }
    }
    return
}

func containsNearbyAlmostDuplicate(nums []int, k, t int) bool {
    set := &treap{}
    for i, v := range nums {
        if lb := set.lowerBound(v - t); lb != nil && lb.val <= v+t {
            return true
        }
        set.put(v)
        if i >= k {
            set.delete(nums[i-k])
        }
    }
    return false
}
```

**å¤æ‚åº¦åˆ†æ**

- æ—¶é—´å¤æ‚åº¦ï¼š$O(n \log(\min(n, k)))$ï¼Œå…¶ä¸­ $n$ æ˜¯ç»™å®šæ•°ç»„çš„é•¿åº¦ã€‚æ¯ä¸ªå…ƒç´ è‡³å¤šè¢«æ’å…¥æœ‰åºé›†åˆå’Œä»æœ‰åºé›†åˆä¸­åˆ é™¤ä¸€æ¬¡ï¼Œæ¯æ¬¡æ“ä½œæ—¶é—´å¤æ‚åº¦å‡ä¸º $O(\log(\min(n, k))$ã€‚

- ç©ºé—´å¤æ‚åº¦ï¼š$O(\min(n, k))$ï¼Œå…¶ä¸­ $n$ æ˜¯ç»™å®šæ•°ç»„çš„é•¿åº¦ã€‚æœ‰åºé›†åˆä¸­è‡³å¤šåŒ…å« $\min(n, k + 1)$ ä¸ªå…ƒç´ ã€‚

#### æ–¹æ³•äºŒï¼šæ¡¶

**æ€è·¯åŠç®—æ³•**

æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨åˆ©ç”¨æ¡¶æ’åºçš„æ€æƒ³è§£å†³æœ¬é¢˜ã€‚æˆ‘ä»¬æŒ‰ç…§å…ƒç´ çš„å¤§å°è¿›è¡Œåˆ†æ¡¶ï¼Œç»´æŠ¤ä¸€ä¸ªæ»‘åŠ¨çª—å£å†…çš„å…ƒç´ å¯¹åº”çš„å…ƒç´ ã€‚

å¯¹äºå…ƒç´  $x$ï¼Œå…¶å½±å“çš„åŒºé—´ä¸º $[x - t, x + t]$ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥è®¾å®šæ¡¶çš„å¤§å°ä¸º $t + 1$ã€‚å¦‚æœä¸¤ä¸ªå…ƒç´ åŒå±ä¸€ä¸ªæ¡¶ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå…ƒç´ å¿…ç„¶ç¬¦åˆæ¡ä»¶ã€‚å¦‚æœä¸¤ä¸ªå…ƒç´ å±äºç›¸é‚»æ¡¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ ¡éªŒè¿™ä¸¤ä¸ªå…ƒç´ æ˜¯å¦å·®å€¼ä¸è¶…è¿‡ $t$ã€‚å¦‚æœä¸¤ä¸ªå…ƒç´ æ—¢ä¸å±äºåŒä¸€ä¸ªæ¡¶ï¼Œä¹Ÿä¸å±äºç›¸é‚»æ¡¶ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå…ƒç´ å¿…ç„¶ä¸ç¬¦åˆæ¡ä»¶ã€‚

å…·ä½“åœ°ï¼Œæˆ‘ä»¬éå†è¯¥åºåˆ—ï¼Œå‡è®¾å½“å‰éå†åˆ°å…ƒç´  $x$ï¼Œé‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆæ£€æŸ¥ $x$ æ‰€å±äºçš„æ¡¶æ˜¯å¦å·²ç»å­˜åœ¨å…ƒç´ ï¼Œå¦‚æœå­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ‰¾åˆ°äº†ä¸€å¯¹ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œå¦åˆ™æˆ‘ä»¬ç»§ç»­æ£€æŸ¥ä¸¤ä¸ªç›¸é‚»çš„æ¡¶å†…æ˜¯å¦å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ã€‚

å®ç°æ–¹é¢ï¼Œæˆ‘ä»¬å°† $\texttt{int}$ èŒƒå›´å†…çš„æ¯ä¸€ä¸ªæ•´æ•° $x$ è¡¨ç¤ºä¸º $x = (t + 1) \times a + b(0 \leq b \leq t)$ çš„å½¢å¼ï¼Œè¿™æ · $x$ å³å½’å±äºç¼–å·ä¸º $a$ çš„æ¡¶ã€‚å› ä¸ºä¸€ä¸ªæ¡¶å†…è‡³å¤šåªä¼šæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨å“ˆå¸Œè¡¨å®ç°å³å¯ã€‚

**ä»£ç **

```C++ [sol2-C++]
class Solution {
public:
    int getID(int x, long w) {
        return x < 0 ? (x + 1ll) / w - 1 : x / w;
    }

    bool containsNearbyAlmostDuplicate(vector<int>& nums, int k, int t) {
        unordered_map<int, int> mp;
        int n = nums.size();
        for (int i = 0; i < n; i++) {
            long x = nums[i];
            int id = getID(x, t + 1ll);
            if (mp.count(id)) {
                return true;
            }
            if (mp.count(id - 1) && abs(x - mp[id - 1]) <= t) {
                return true;
            }
            if (mp.count(id + 1) && abs(x - mp[id + 1]) <= t) {
                return true;
            }
            mp[id] = x;
            if (i >= k) {
                mp.erase(getID(nums[i - k], t + 1ll));
            }
        }
        return false;
    }
};
```

```Java [sol2-Java]
class Solution {
    public boolean containsNearbyAlmostDuplicate(int[] nums, int k, int t) {
        int n = nums.length;
        Map<Long, Long> map = new HashMap<Long, Long>();
        long w = (long) t + 1;
        for (int i = 0; i < n; i++) {
            long id = getID(nums[i], w);
            if (map.containsKey(id)) {
                return true;
            }
            if (map.containsKey(id - 1) && Math.abs(nums[i] - map.get(id - 1)) < w) {
                return true;
            }
            if (map.containsKey(id + 1) && Math.abs(nums[i] - map.get(id + 1)) < w) {
                return true;
            }
            map.put(id, (long) nums[i]);
            if (i >= k) {
                map.remove(getID(nums[i - k], w));
            }
        }
        return false;
    }

    public long getID(long x, long w) {
        if (x >= 0) {
            return x / w;
        }
        return (x + 1) / w - 1;
    }
}
```

```JavaScript [sol2-JavaScript]
var containsNearbyAlmostDuplicate = function(nums, k, t) {
    const n = nums.length;
    const mp = new Map();
    for (let i = 0; i < n; ++i) {
        const x = nums[i];
        const id = getID(x, t + 1);
        if (mp.has(id)) {
            return true;
        }
        if (mp.has(id - 1) && Math.abs(x - mp.get(id - 1)) <= t) {
            return true;
        }
        if (mp.has(id + 1) && Math.abs(x - mp.get(id + 1)) <= t) {
            return true;
        }
        mp.set(id, x);
        if (i >= k) {
            mp.delete(getID(nums[i - k], t + 1));
        }
    }
    return false;
};

const getID = (x, w) => {
    return x < 0 ? Math.floor((x + 1) / w) - 1 : Math.floor(x / w);
}
```

```go [sol2-Golang]
func getID(x, w int) int {
    if x >= 0 {
        return x / w
    }
    return (x+1)/w - 1
}

func containsNearbyAlmostDuplicate(nums []int, k, t int) bool {
    mp := map[int]int{}
    for i, x := range nums {
        id := getID(x, t+1)
        if _, has := mp[id]; has {
            return true
        }
        if y, has := mp[id-1]; has && abs(x-y) <= t {
            return true
        }
        if y, has := mp[id+1]; has && abs(x-y) <= t {
            return true
        }
        mp[id] = x
        if i >= k {
            delete(mp, getID(nums[i-k], t+1))
        }
    }
    return false
}

func abs(x int) int {
    if x < 0 {
        return -x
    }
    return x
}
```

```C [sol2-C]
struct HashTable {
    int key;
    int val;
    UT_hash_handle hh;
};

int getID(int x, long long w) {
    return x < 0 ? (x + 1ll) / w - 1 : x / w;
}

struct HashTable* query(struct HashTable* hashTable, int x) {
    struct HashTable* tmp;
    HASH_FIND_INT(hashTable, &x, tmp);
    return tmp;
}

bool containsNearbyAlmostDuplicate(int* nums, int numsSize, int k, int t) {
    struct HashTable* hashTable = NULL;
    for (int i = 0; i < numsSize; i++) {
        long long x = nums[i];
        int id = getID(x, t + 1ll);
        struct HashTable* tmp;
        tmp = query(hashTable, id - 1);
        if (tmp != NULL && fabs(x - tmp->val) <= t) {
            return true;
        }
        tmp = query(hashTable, id + 1);
        if (tmp != NULL && fabs(x - tmp->val) <= t) {
            return true;
        }
        tmp = query(hashTable, id);
        if (tmp != NULL) {
            return true;
        } else {
            tmp = malloc(sizeof(struct HashTable));
            tmp->key = id;
            tmp->val = x;
            HASH_ADD_INT(hashTable, key, tmp);
        }
        if (i >= k) {
            tmp = query(hashTable, getID(nums[i - k], t + 1ll));
            HASH_DEL(hashTable, tmp);
        }
    }
    return false;
}
```

**å¤æ‚åº¦åˆ†æ**

- æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$ï¼Œå…¶ä¸­ $n$ æ˜¯ç»™å®šæ•°ç»„çš„é•¿åº¦ã€‚æ¯ä¸ªå…ƒç´ è‡³å¤šè¢«æ’å…¥å“ˆå¸Œè¡¨å’Œä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ä¸€æ¬¡ï¼Œæ¯æ¬¡æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å‡ä¸º $O(1)$ã€‚

- ç©ºé—´å¤æ‚åº¦ï¼š$O(\min(n, k))$ï¼Œå…¶ä¸­ $n$ æ˜¯ç»™å®šæ•°ç»„çš„é•¿åº¦ã€‚å“ˆå¸Œè¡¨ä¸­è‡³å¤šåŒ…å« $\min(n, k + 1)$ ä¸ªå…ƒç´ ã€‚